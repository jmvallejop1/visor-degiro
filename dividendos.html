<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visor DeGiro - Dividendos</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="dividendos.css" />
    <meta name="description" content="Agrupar y analizar dividendos (bruto, retenci√≥n, neto) por evento y producto, gestionando cambios de divisa." />
</head>
<body>
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">üìä Visor DeGiro</div>
            <div class="nav-links">
                <a href="index.html" class="nav-item">üíº Portfolio</a>
                <a href="dividendos.html" class="nav-item active">üíµ Dividendos</a>
                <a href="operaciones.html" class="nav-item">üìà Operaciones</a>
            </div>
        </nav>

        <header>
            <h1>üíµ Dividendos</h1>
            <p>Agrupa todas las l√≠neas de un mismo pago (bruto, retenci√≥n, FX) y calcula el neto.</p>
        </header>

        <!-- Resumen por divisa primero -->
        <section class="table-section">
            <h3>üí± Resumen por divisa</h3>
            <button id="toggleCurrencyTable" class="collapse-toggle" aria-expanded="true" title="Contraer/Expandir">‚ñº</button>
            <div class="table-wrapper">
                <table id="currencyTable">
                    <thead>
                        <tr>
                            <th>Divisa</th>
                            <th>Bruto</th>
                            <th>Retenci√≥n</th>
                            <th>Neto</th>
                        </tr>
                    </thead>
                    <tbody id="currencyBody"></tbody>
                </table>
            </div>
        </section>

        <section class="analysis-section">
            <h3>üìÜ Evoluci√≥n anual por producto</h3>
            <div class="analysis-controls">
                <label for="productYearSelect">Selecciona un producto</label>
                <select id="productYearSelect">
                    <option value="">-- Elige un producto --</option>
                </select>
            </div>
            <div class="analysis-summary">
                <div class="summary-card">
                    <span>Total neto (producto)</span>
                    <strong id="productTotalNet">-</strong>
                </div>
                <div class="summary-card">
                    <span>A√±os con dividendos</span>
                    <strong id="productYearsCount">-</strong>
                </div>
                <div class="summary-card">
                    <span>Acciones actuales</span>
                    <strong id="productCurrentShares">-</strong>
                </div>
            </div>
            <div class="analysis-charts">
                <div class="chart-container small">
                    <h4>Dividendos netos por a√±o</h4>
                    <canvas id="productYearBar"></canvas>
                </div>
            </div>
            <div class="table-wrapper">
                <table id="productYearTable">
                    <thead>
                        <tr>
                            <th>A√±o</th>
                            <th>Dividendos netos</th>
                            <th>Coste medio</th>
                            <th>Rentabilidad anual</th>
                            <th>Acciones medias</th>
                            <th>Dividendo por acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="productYearBody">
                        <tr>
                            <td colspan="6" class="empty-state">Selecciona un producto para ver el detalle anual.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="comparison-section">
            <h3>üìä Comparativa anual de rentabilidad</h3>
            <div class="analysis-controls">
                <label for="annualYieldYearSelect">Selecciona un a√±o</label>
                <select id="annualYieldYearSelect">
                    <option value="">-- Elige un a√±o --</option>
                </select>
            </div>
            <div class="chart-container medium">
                <h4>Rentabilidad por producto</h4>
                <canvas id="annualYieldChart"></canvas>
            </div>
            <p id="annualYieldEmpty" class="empty-state" style="display: none;">Sin datos para el a√±o seleccionado.</p>
        </section>

        <!-- Resumen por producto -->
        <section class="table-section">
            <h3>üè¶ Resumen por producto</h3>
            <button id="toggleProductTable" class="collapse-toggle" aria-expanded="true" title="Contraer/Expandir">‚ñº</button>
            <div class="filters-row">
                <input type="text" id="searchProduct" placeholder="Buscar por producto o ISIN..." />
                <input type="month" id="filterMonth" />
                <button id="clearFilters">Limpiar filtros</button>
            </div>
            <div class="table-wrapper">
                <table id="productTable">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Producto</th>
                            <th>ISIN</th>
                            <th>Eventos</th>
                            <th>Divisa</th>
                            <th>Bruto</th>
                            <th>Retenci√≥n</th>
                            <th>Neto</th>
                        </tr>
                    </thead>
                    <tbody id="productBody"></tbody>
                </table>
            </div>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="dividendos.js"></script>
</body>
</html>
